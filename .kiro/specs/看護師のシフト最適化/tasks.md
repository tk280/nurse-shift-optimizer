# Implementation Plan

## 実装ステータス
- フェーズ: 実装完了
- 最終更新: 現行コード反映済み

- [x] 1. 入力データの取り込みと検証基盤の整備
- [x] 1.1 計画期間・看護師・勤務区分・需要の入力を内部表現へ正規化
- [x] 1.2 重複勤務と期間整合性の検証

- [x] 2. ハード制約のモデル化
- [x] 2.1 必要人数、勤務上限、夜勤後休息の制約を定義
- [x] 2.2 実行不能時の理由収集を実装
- [x] 2.3 高度な Hard 制約を追加
  - [x] 夜勤に登録看護師を最低1名
  - [x] 新人単独夜勤の禁止
  - [x] 週次勤務上限（Mon-Sun）
  - [x] 週1日以上の休養日制約
  - [x] 病棟所属制約、支援要員制約
  - [x] 月間労働時間・月間夜勤上限
  - [x] 夜勤後の禁止遷移

- [x] 3. ソフト制約と最適化実行制御
- [x] 3.1 希望休・公平性・スキル優先の目的関数を構築
- [x] 3.2 実行パラメータとステータス制御を実装
- [x] 3.3 高度な Soft 制約を追加
  - [x] 夜勤公平性
  - [x] 週末公平性
  - [x] 祝日公平性
  - [x] 新人と経験者同席推奨
  - [x] 急激なシフト遷移抑制
  - [x] 外部/支援要員利用の抑制

- [x] 4. 結果整形と出力
- [x] 4.1 シフト表、制約サマリー、違反情報を JSON で返却
- [x] 4.2 実行不能時の分析結果を構造化して返却

- [x] 5. Web UI の機能実装
- [x] 5.1 入力フォームと実行開始 UI
- [x] 5.2 進捗・結果・エラー表示
- [x] 5.3 手動調整と JSON エクスポート
- [x] 5.4 日別必要人数表の動的生成
  - [x] 開始日を1日目として計画日数分を自動作成
  - [x] 各列にデフォルト値を自動設定
- [x] 5.5 実行不能時の推奨修正ボタン

- [x] 6. UI/UX 改善
- [x] 6.1 日本語表示への統一
- [x] 6.2 カレンダー/表形式での結果可視化
- [x] 6.3 左ペーン説明文・ツールチップの整備
- [x] 6.4 サマリー文字色、凡例文字色の視認性改善
- [x] 6.5 入力コンポーネント（開始日・計画日数・ダウンロード）のコントラスト改善

- [x] 7. テスト
- [x] 7.1 単体テストで入力検証・制約・目的関数・結果整形を確認
- [x] 7.2 統合テストで実行不能分析とメタデータを確認
- [x] 7.3 回帰テストで UI 連携に必要な入出力仕様を確認

## 補足
- 追加変更に応じて `requirements.md` / `design.md` / `tasks.md` を同期済み
- 直近の重点は「高度制約の入力性」「実行不能時の説明可能性」「UI視認性改善」
